extends layout
include mixins

block styles
	link(rel='stylesheet' href='/css/positions.css')
	link(rel='stylesheet' href='/css/components.css')
	style.
		body {
			background-color: #f8f9fa;
		}
		.trade-card {
			border: 1px solid #ddd;
			border-radius: 8px;
			margin-bottom: 1rem;
			padding: 1rem;
			background: #fff;
		}
		.trade-header {
			font-weight: bold;
			font-size: 1.1rem;
			border-bottom: 1px solid #eee;
			padding-bottom: 0.5rem;
			margin-bottom: 0.75rem;
		}
		.trade-date {
			color: #666;
			font-weight: normal;
			font-size: 0.8rem;
		}
		
		/* Sidebar styles */
		.sidebar {
			background: #fff;
			border: 1px solid #ddd;
			border-radius: 8px;
			padding: 1rem;
			margin-bottom: 1rem;
		}
		.sidebar-section {
			margin-bottom: 1.25rem;
		}
		.sidebar-section:last-child {
			margin-bottom: 0;
		}
		.sidebar-title {
			font-weight: 600;
			font-size: 0.85rem;
			color: #495057;
			margin-bottom: 0.5rem;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}
		.sidebar select {
			font-size: 0.875rem;
		}
		.sidebar .btn {
			font-size: 0.875rem;
		}
		.filter-summary {
			font-size: 0.8rem;
			color: #666;
			margin-top: 0.75rem;
			padding-top: 0.75rem;
			border-top: 1px solid #eee;
		}
		.filter-summary .active-filter {
			display: inline-block;
			background: #e7f1ff;
			border: 1px solid #b6d4fe;
			border-radius: 4px;
			padding: 0.15rem 0.4rem;
			margin: 0.15rem 0;
		}
		.filter-summary .remove-filter {
			color: #6c757d;
			text-decoration: none;
			margin-left: 0.25rem;
		}
		.filter-summary .remove-filter:hover {
			color: #dc3545;
		}
		.pagination-info {
			font-size: 0.85rem;
			color: #666;
			margin-bottom: 0.5rem;
		}
		.pagination-nav {
			display: flex;
			align-items: center;
			gap: 0.75rem;
		}
		.pagination-left, .pagination-right {
			display: flex;
			gap: 0.5rem;
		}
		.sidebar-nav {
			display: flex;
			justify-content: space-between;
		}
		.sidebar-nav-left, .sidebar-nav-right {
			display: flex;
			gap: 0.25rem;
		}
		.trade-nav {
			display: flex;
			align-items: center;
			gap: 0.75rem;
			margin-bottom: 1rem;
		}
		.trade-nav-link {
			display: inline-flex;
			align-items: center;
			gap: 0.35rem;
			padding: 0.4rem 0.75rem;
			border: 1px solid #ddd;
			border-radius: 6px;
			text-decoration: none;
			color: #495057;
			font-size: 0.9rem;
			transition: all 0.15s;
		}
		.trade-nav-link:hover {
			background: #f8f9fa;
			border-color: #adb5bd;
			text-decoration: none;
			color: #212529;
		}
		/* Sticky sidebar on large screens */
		@media (min-width: 992px) {
			.sidebar-sticky {
				position: sticky;
				top: calc(56px + 1rem);
			}
		}

block content
	div.container.py-4
		if singleTrade
			p.mb-4
				a(href="/trades") ← Back to All Trades
			
			//- Navigation at top for quick clicking
			div.trade-nav.mb-3
				if prevTradeId
					a.trade-nav-link(href="/trades/" + prevTradeId)
						i.fa.fa-chevron-left
						|  ##{prevTradeId}
				else
					span.trade-nav-link.invisible
						i.fa.fa-chevron-left
						|  #000
				span.flex-grow-1
				if nextTradeId
					a.trade-nav-link(href="/trades/" + nextTradeId)
						| ##{nextTradeId} 
						i.fa.fa-chevron-right
				else
					span.trade-nav-link.invisible
						| #000 
						i.fa.fa-chevron-right
			
			each trade in trades
				div.trade-card(id="trade-" + trade.number)
					div.trade-header
						a(href="/trades/" + trade.number style="color: inherit; text-decoration: none;") Trade ##{trade.number}
						div.trade-date #{trade.timestamp.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })} at #{trade.timestamp.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', timeZone: 'America/New_York' }).toLowerCase()} ET
					
					each party in trade.parties
						+tradeParty(party)
					
					if trade.notes
						div.trade-notes #{trade.notes}
			
			//- Bottom navigation
			div.trade-nav.mt-4
				if prevTradeId
					a.trade-nav-link(href="/trades/" + prevTradeId)
						i.fa.fa-chevron-left
						|  ##{prevTradeId}
				else
					span.trade-nav-link.invisible
						i.fa.fa-chevron-left
						|  #000
				span.flex-grow-1
				if nextTradeId
					a.trade-nav-link(href="/trades/" + nextTradeId)
						| ##{nextTradeId} 
						i.fa.fa-chevron-right
				else
					span.trade-nav-link.invisible
						| #000 
						i.fa.fa-chevron-right
		else
			h1.mb-4 Trade History
			
			div.row
				//- Sidebar
				div.col-lg-3.order-lg-2.mb-4.mb-lg-0
					div.sidebar.sidebar-sticky
						//- Go to trade
						div.sidebar-section
							div.sidebar-title Jump to Trade
							form.input-group.input-group-sm(onsubmit="window.location.href='/trades/' + this.q.value; return false;")
								input.form-control(type="text" name="q" placeholder="#" pattern="[0-9]+" title="Enter a trade number")
								div.input-group-append
									button.btn.btn-outline-secondary(type="submit") Go
						
						//- Filters
						div.sidebar-section
							div.sidebar-title Filter
							form(method="get" action="/trades")
								div.form-group.mb-2
									label.small.mb-1(for="franchise-filter") Franchise
									select#franchise-filter.form-control.form-control-sm(name="franchise")
										option(value="") All
										each regime in regimes
											option(value=regime.franchiseId.toString() selected=(filterFranchise === regime.franchiseId.toString()))= regime.displayName
								
								div.form-group.mb-2
									label.small.mb-1(for="partner-filter") Trading with
									select#partner-filter.form-control.form-control-sm(name="partner")
										option(value="") Anyone
										each regime in regimes
											option(value=regime.franchiseId.toString() selected=(filterPartner === regime.franchiseId.toString()))= regime.displayName
								
								button.btn.btn-primary.btn-sm.btn-block(type="submit")
									i.fa.fa-filter.mr-1
									| Apply
							
							if filterFranchise || filterPartner
								div.filter-summary
									| Showing: 
									if filterFranchise
										span.active-filter
											= filterFranchiseName
											a.remove-filter(href=filterPartner ? "/trades?partner=" + filterPartner : "/trades") ×
									if filterPartner
										if filterFranchise
											|  + 
										span.active-filter
											= filterPartnerName
											a.remove-filter(href=filterFranchise ? "/trades?franchise=" + filterFranchise : "/trades") ×
									div.text-muted.small.mt-1 (includes past owners)
						
						//- Pagination
						if totalFiltered > 0
							div.sidebar-section
								div.sidebar-title Browse
								div.pagination-info
									if filterFranchise || filterPartner
										| #{totalFiltered} of #{totalTrades} trades
									else
										| #{totalTrades} trades
									if perPage
										br
										if isDefaultView
											| Newest
										else
											| Page #{page} of #{totalPages}
								
								if perPage && totalPages > 1
									div.sidebar-nav
										div.sidebar-nav-left
											if olderPage
												a.trade-nav-link(href="/trades" + buildQuery(1, perPage)) «
												a.trade-nav-link(href="/trades" + buildQuery(olderPage, perPage)) ‹
											else
												span.trade-nav-link.invisible «
												span.trade-nav-link.invisible ‹
										div.sidebar-nav-right
											if newerPage
												a.trade-nav-link(href="/trades" + buildQuery(newerPage, perPage)) ›
												a.trade-nav-link(href="/trades") »
											else if !isDefaultView
												span.trade-nav-link.invisible ›
												a.trade-nav-link(href="/trades") »
											else
												span.trade-nav-link.invisible ›
												span.trade-nav-link.invisible »
				
				//- Main content
				div.col-lg-9.order-lg-1
					//- Top pagination
					if perPage && totalPages > 1
						div.pagination-nav.mb-3
							div.pagination-left
								if olderPage
									a.trade-nav-link(href="/trades" + buildQuery(1, perPage)) « Oldest
									a.trade-nav-link(href="/trades" + buildQuery(olderPage, perPage)) ‹ Older
								else
									span.trade-nav-link.invisible « Oldest
									span.trade-nav-link.invisible ‹ Older
							span.flex-grow-1
							div.pagination-right
								if newerPage
									a.trade-nav-link(href="/trades" + buildQuery(newerPage, perPage)) Newer ›
									a.trade-nav-link(href="/trades") Newest »
								else if !isDefaultView
									span.trade-nav-link.invisible Newer ›
									a.trade-nav-link(href="/trades") Newest »
								else
									span.trade-nav-link.invisible Newer ›
									span.trade-nav-link.invisible Newest »
					
					if trades.length === 0
						div.text-center.py-5
							i.fa.fa-exchange.fa-3x.text-muted.mb-3
							p.text-muted No trades found matching your filters.
					
					each trade in trades
						div.trade-card(id="trade-" + trade.number)
							div.trade-header
								a(href="/trades/" + trade.number style="color: inherit; text-decoration: none;") Trade ##{trade.number}
								div.trade-date #{trade.timestamp.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })} at #{trade.timestamp.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', timeZone: 'America/New_York' }).toLowerCase()} ET
							
							each party in trade.parties
								+tradeParty(party)
							
							if trade.notes
								div.trade-notes #{trade.notes}
					
					//- Bottom pagination
					if perPage && totalPages > 1
						div.pagination-nav.mt-4
							div.pagination-left
								if olderPage
									a.trade-nav-link(href="/trades" + buildQuery(1, perPage)) « Oldest
									a.trade-nav-link(href="/trades" + buildQuery(olderPage, perPage)) ‹ Older
								else
									span.trade-nav-link.invisible « Oldest
									span.trade-nav-link.invisible ‹ Older
							span.flex-grow-1
							div.pagination-right
								if newerPage
									a.trade-nav-link(href="/trades" + buildQuery(newerPage, perPage)) Newer ›
									a.trade-nav-link(href="/trades") Newest »
								else if !isDefaultView
									span.trade-nav-link.invisible Newer ›
									a.trade-nav-link(href="/trades") Newest »
								else
									span.trade-nav-link.invisible Newer ›
									span.trade-nav-link.invisible Newest »
