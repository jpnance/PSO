extends layout

block styles
	style.
		body {
			background-color: #f8f9fa;
		}
		.asset-name {
			display: flex;
			align-items: center;
			font-weight: 600;
			color: #212529;
		}
		.asset-meta {
			font-size: 0.8rem;
			color: #666;
		}
		.player-position {
			font-size: 0.7rem;
			padding: 0.15rem 0.35rem;
			border-radius: 0.25rem;
			border: 1px solid;
			margin-left: 0.35rem;
			vertical-align: middle;
		}
		.player-position.pos-QB { background-color: #D7EBFF; color: #1a5276; border-color: #1a5276; }
		.player-position.pos-RB { background-color: #F0FFFF; color: #117a65; border-color: #117a65; }
		.player-position.pos-WR { background-color: #FAFAD2; color: #9a7b0a; border-color: #9a7b0a; }
		.player-position.pos-TE { background-color: #DCFFDC; color: #1e8449; border-color: #1e8449; }
		.player-position.pos-DL, .player-position.pos-LB, .player-position.pos-DB { background-color: #FFF5EE; color: #a04000; border-color: #a04000; }
		.player-position.pos-K { background-color: #F5F5F5; color: #5d6d7e; border-color: #5d6d7e; }
		.trade-card {
			border: 1px solid #ddd;
			border-radius: 8px;
			margin-bottom: 1rem;
			padding: 1rem;
			background: #fff;
		}
		.trade-header {
			font-weight: bold;
			font-size: 1.1rem;
			border-bottom: 1px solid #eee;
			padding-bottom: 0.5rem;
			margin-bottom: 0.75rem;
		}
		.trade-date {
			color: #666;
			font-weight: normal;
			font-size: 0.8rem;
		}
		.party:not(:last-child) .asset-list {
			margin-bottom: 1.25rem;
		}
		.party-name {
			font-weight: 600;
		}
		/* Asset list - compact bullet style */
		.asset-list {
			list-style: none;
			margin: 0.25rem 0 0 0;
			padding: 0;
		}
		.asset-list li {
			display: flex;
			align-items: flex-start;
			padding: 0.35rem 0;
			font-size: 0.9rem;
		}
		.asset-icon {
			flex-shrink: 0;
			width: 1.25rem;
			text-align: center;
			margin-right: 0.5rem;
		}
		.asset-content {
			flex: 1;
			padding-left: 0.5rem;
			border-left: 1px solid currentColor;
		}
		/* Asset type colors */
		.asset-icon.icon-player, .asset-content.icon-player { color: #28a745; }
		.asset-icon.icon-pick, .asset-content.icon-pick { color: #17a2b8; }
		.asset-icon.icon-cash, .asset-content.icon-cash { color: #d39e00; }
		.asset-icon.icon-rfa, .asset-content.icon-rfa { color: #6f42c1; }
		.asset-icon.icon-nothing, .asset-content.icon-nothing { color: #adb5bd; }
		.asset-content .asset-text {
			color: #212529;
		}
		.asset-note {
			font-size: 0.75rem;
			color: #888;
			font-style: italic;
			margin-top: 0.1rem;
		}
		.trade-notes {
			font-style: italic;
			color: #666;
			font-size: 0.85rem;
			margin-top: 0.5rem;
		}
		.ambiguous-icon {
			margin-left: 0.35rem;
			color: #999;
			cursor: help;
		}
		.ambiguous-icon:hover {
			color: #666;
		}
		
		/* Sidebar styles */
		.sidebar {
			background: #fff;
			border: 1px solid #ddd;
			border-radius: 8px;
			padding: 1rem;
			margin-bottom: 1rem;
		}
		.sidebar-section {
			margin-bottom: 1.25rem;
		}
		.sidebar-section:last-child {
			margin-bottom: 0;
		}
		.sidebar-title {
			font-weight: 600;
			font-size: 0.85rem;
			color: #495057;
			margin-bottom: 0.5rem;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}
		.sidebar select {
			font-size: 0.875rem;
		}
		.sidebar .btn {
			font-size: 0.875rem;
		}
		.filter-summary {
			font-size: 0.8rem;
			color: #666;
			margin-top: 0.75rem;
			padding-top: 0.75rem;
			border-top: 1px solid #eee;
		}
		.filter-summary .active-filter {
			display: inline-block;
			background: #e7f1ff;
			border: 1px solid #b6d4fe;
			border-radius: 4px;
			padding: 0.15rem 0.4rem;
			margin: 0.15rem 0;
		}
		.filter-summary .remove-filter {
			color: #6c757d;
			text-decoration: none;
			margin-left: 0.25rem;
		}
		.filter-summary .remove-filter:hover {
			color: #dc3545;
		}
		.pagination-info {
			font-size: 0.85rem;
			color: #666;
			margin-bottom: 0.5rem;
		}
		.pagination-compact {
			display: flex;
			flex-wrap: wrap;
			gap: 0.25rem;
		}
		.pagination-compact .btn {
			padding: 0.2rem 0.4rem;
			font-size: 0.8rem;
		}
		.trade-nav {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 1rem;
		}
		.trade-nav-link {
			display: inline-flex;
			align-items: center;
			gap: 0.3rem;
			padding: 0.4rem 0.8rem;
			border: 1px solid #ddd;
			border-radius: 6px;
			text-decoration: none;
			color: #495057;
			font-size: 0.9rem;
			transition: all 0.15s;
		}
		.trade-nav-link:hover {
			background: #f8f9fa;
			border-color: #adb5bd;
			text-decoration: none;
			color: #212529;
		}
		.trade-nav-link.disabled {
			opacity: 0.4;
			pointer-events: none;
		}
		/* Sticky sidebar on large screens */
		@media (min-width: 992px) {
			.sidebar-sticky {
				position: sticky;
				top: calc(56px + 1rem);
			}
		}

block content
	div.container.py-4
		if singleTrade
			p.mb-2
				a(href="/trades") ← All Trades
			h1.mb-3 Trade ##{tradeNumber}
			
			each trade in trades
				div.trade-card(id="trade-" + trade.number)
					div.trade-header
						| Trade ##{trade.number}
						div.trade-date #{trade.timestamp.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })} at #{trade.timestamp.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', timeZone: 'America/New_York' }).toLowerCase()} ET
					
					each party in trade.parties
						div.party
							span.party-name #{party.franchiseName}
							if party.usePlural
								|  receive:
							else
								|  receives:
							ul.asset-list
								each asset in party.assets
									li
										span.asset-icon(class="icon-" + asset.type)
											if asset.type === 'player'
												i.fa.fa-user
											else if asset.type === 'pick'
												i.fa.fa-ticket
											else if asset.type === 'cash'
												i.fa.fa-dollar
											else if asset.type === 'rfa'
												i.fa.fa-file-text-o
											else
												i.fa.fa-times
										div.asset-content(class="icon-" + asset.type)
											if (asset.type === 'player' || asset.type === 'rfa') && asset.playerName
												div.asset-name
													| #{asset.playerName}
													if asset.positions && asset.positions.length > 0
														span.player-position(class="pos-" + asset.positions[0])= asset.positions.join('/')
												div.asset-meta
													| #{asset.contractInfo}
													if asset.ambiguous
														span.ambiguous-icon(title="Contract years couldn't be definitively determined" data-toggle="tooltip")
															i.fa.fa-question-circle
											else if asset.type === 'pick' && asset.pickMain
												span.asset-text
													strong #{asset.pickMain}
													|  #{asset.pickContext}
											else if asset.type === 'cash' && asset.cashMain
												span.asset-text
													strong #{asset.cashMain}
													|  #{asset.cashContext}
											else
												span.asset-text
													| #{asset.display}
													if asset.ambiguous
														span.ambiguous-icon(title="Contract years couldn't be definitively determined" data-toggle="tooltip")
															i.fa.fa-question-circle
											if asset.notes && asset.notes.length > 0
												each note in asset.notes
													if note.type === 'chain'
														div.asset-note
															each item, idx in note.items
																if idx > 0
																	if item.type === 'outcome'
																		|  → 
																	else
																		|  #{note.separator} 
																if item.type === 'outcome'
																	| #{item.text}
																else if item.isCurrent
																	strong ##{item.tradeNumber}
																else
																	a(href="/trades/" + item.tradeNumber) ##{item.tradeNumber}
													else if note.type === 'outcome'
														div.asset-note → #{note.text}
					
					if trade.notes
						div.trade-notes #{trade.notes}
			
			//- Bottom navigation for single trade view
			div.trade-nav.mt-3.pt-3.border-top
				if prevTradeId
					a.trade-nav-link(href="/trades/" + prevTradeId)
						i.fa.fa-chevron-left
						|  Trade ##{prevTradeId}
				else
					span.trade-nav-link.disabled
						i.fa.fa-chevron-left
						|  Older
				
				if nextTradeId
					a.trade-nav-link(href="/trades/" + nextTradeId)
						| Trade ##{nextTradeId} 
						i.fa.fa-chevron-right
				else
					span.trade-nav-link.disabled
						| Newer 
						i.fa.fa-chevron-right
		else
			h1.mb-4 Trade History
			
			div.row
				//- Sidebar
				div.col-lg-3.order-lg-2.mb-4.mb-lg-0
					div.sidebar.sidebar-sticky
						//- Go to trade
						div.sidebar-section
							div.sidebar-title Jump to Trade
							form.input-group.input-group-sm(onsubmit="window.location.href='/trades/' + this.q.value; return false;")
								input.form-control(type="text" name="q" placeholder="#" pattern="[0-9]+" title="Enter a trade number")
								div.input-group-append
									button.btn.btn-outline-secondary(type="submit") Go
						
						//- Filters
						div.sidebar-section
							div.sidebar-title Filter
							form(method="get" action="/trades")
								div.form-group.mb-2
									label.small.mb-1(for="franchise-filter") Franchise
									select#franchise-filter.form-control.form-control-sm(name="franchise")
										option(value="") All
										each regime in regimes
											option(value=regime.franchiseId.toString() selected=(filterFranchise === regime.franchiseId.toString()))= regime.displayName
								
								div.form-group.mb-2
									label.small.mb-1(for="partner-filter") Trading with
									select#partner-filter.form-control.form-control-sm(name="partner")
										option(value="") Anyone
										each regime in regimes
											option(value=regime.franchiseId.toString() selected=(filterPartner === regime.franchiseId.toString()))= regime.displayName
								
								button.btn.btn-primary.btn-sm.btn-block(type="submit")
									i.fa.fa-filter.mr-1
									| Apply
							
							if filterFranchise || filterPartner
								div.filter-summary
									| Showing: 
									if filterFranchise
										span.active-filter
											= filterFranchiseName
											a.remove-filter(href="/trades") ×
									if filterPartner
										if filterFranchise
											|  + 
										span.active-filter
											= filterPartnerName
											a.remove-filter(href=filterFranchise ? "/trades?franchise=" + filterFranchise : "/trades") ×
									div.text-muted.small.mt-1 (includes past owners)
						
						//- Pagination
						if totalFiltered > 0
							div.sidebar-section
								div.sidebar-title Browse
								div.pagination-info
									if filterFranchise || filterPartner
										| #{totalFiltered} of #{totalTrades} trades
									else
										| #{totalTrades} trades
									if perPage
										br
										| Page #{page} of #{totalPages}
								
								if perPage && totalPages > 1
									div.pagination-compact
										if page > 1
											a.btn.btn-outline-secondary(href="/trades" + buildQuery(1, perPage)) «
											a.btn.btn-outline-secondary(href="/trades" + buildQuery(page - 1, perPage)) ‹
										else
											span.btn.btn-outline-secondary.disabled «
											span.btn.btn-outline-secondary.disabled ‹
										
										if page < totalPages
											a.btn.btn-outline-secondary(href="/trades" + buildQuery(page + 1, perPage)) ›
											a.btn.btn-outline-secondary(href="/trades" + buildQuery(totalPages, perPage)) »
										else
											span.btn.btn-outline-secondary.disabled ›
											span.btn.btn-outline-secondary.disabled »
				
				//- Main content
				div.col-lg-9.order-lg-1
					if trades.length === 0
						div.text-center.py-5
							i.fa.fa-exchange.fa-3x.text-muted.mb-3
							p.text-muted No trades found matching your filters.
					
					each trade in trades
						div.trade-card(id="trade-" + trade.number)
							div.trade-header
								a(href="/trades/" + trade.number style="color: inherit; text-decoration: none;") Trade ##{trade.number}
								div.trade-date #{trade.timestamp.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })} at #{trade.timestamp.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', timeZone: 'America/New_York' }).toLowerCase()} ET
							
							each party in trade.parties
								div.party
									span.party-name #{party.franchiseName}
									if party.usePlural
										|  receive:
									else
										|  receives:
									ul.asset-list
										each asset in party.assets
											li
												span.asset-icon(class="icon-" + asset.type)
													if asset.type === 'player'
														i.fa.fa-user
													else if asset.type === 'pick'
														i.fa.fa-ticket
													else if asset.type === 'cash'
														i.fa.fa-dollar
													else if asset.type === 'rfa'
														i.fa.fa-file-text-o
													else
														i.fa.fa-times
												div.asset-content(class="icon-" + asset.type)
													if (asset.type === 'player' || asset.type === 'rfa') && asset.playerName
														div.asset-name
															| #{asset.playerName}
															if asset.positions && asset.positions.length > 0
																span.player-position(class="pos-" + asset.positions[0])= asset.positions.join('/')
														div.asset-meta
															| #{asset.contractInfo}
															if asset.ambiguous
																span.ambiguous-icon(title="Contract years couldn't be definitively determined" data-toggle="tooltip")
																	i.fa.fa-question-circle
													else if asset.type === 'pick' && asset.pickMain
														span.asset-text
															strong #{asset.pickMain}
															|  #{asset.pickContext}
													else if asset.type === 'cash' && asset.cashMain
														span.asset-text
															strong #{asset.cashMain}
															|  #{asset.cashContext}
													else
														span.asset-text
															| #{asset.display}
															if asset.ambiguous
																span.ambiguous-icon(title="Contract years couldn't be definitively determined" data-toggle="tooltip")
																	i.fa.fa-question-circle
													if asset.notes && asset.notes.length > 0
														each note in asset.notes
															if note.type === 'chain'
																div.asset-note
																	each item, idx in note.items
																		if idx > 0
																			if item.type === 'outcome'
																				|  → 
																			else
																				|  #{note.separator} 
																		if item.type === 'outcome'
																			| #{item.text}
																		else if item.isCurrent
																			strong ##{item.tradeNumber}
																		else
																			a(href="/trades/" + item.tradeNumber) ##{item.tradeNumber}
															else if note.type === 'outcome'
																div.asset-note → #{note.text}
							
							if trade.notes
								div.trade-notes #{trade.notes}
					
					//- Bottom pagination
					if perPage && totalPages > 1
						div.d-flex.justify-content-center.mt-4.pt-3.border-top
							div.pagination-compact
								if page > 1
									a.btn.btn-outline-secondary(href="/trades" + buildQuery(1, perPage)) « First
									a.btn.btn-outline-secondary(href="/trades" + buildQuery(page - 1, perPage)) ‹ Prev
								else
									span.btn.btn-outline-secondary.disabled « First
									span.btn.btn-outline-secondary.disabled ‹ Prev
								
								span.px-2.text-muted Page #{page} of #{totalPages}
								
								if page < totalPages
									a.btn.btn-outline-secondary(href="/trades" + buildQuery(page + 1, perPage)) Next ›
									a.btn.btn-outline-secondary(href="/trades" + buildQuery(totalPages, perPage)) Last »
								else
									span.btn.btn-outline-secondary.disabled Next ›
									span.btn.btn-outline-secondary.disabled Last »
