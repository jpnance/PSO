//- Inline budget impact summary for trade machine
//- Renders a combined view of budget impact for all parties
//- 
//- Expected data:
//- budgetImpact: { franchises: [...], seasons: [...], isCashNeutral: boolean, currentSeason: number }
//- showCashNeutralButtons: boolean (optional, defaults to false)

if budgetImpact && budgetImpact.franchises && budgetImpact.franchises.length > 0
	//- Compute which seasons are not cash-neutral
	- var seasonNeutral = {}
	- budgetImpact.seasons.forEach(function(s) { seasonNeutral[s] = true; })
	- budgetImpact.franchises.forEach(function(f) { f.seasons.forEach(function(sd) { if (sd.delta !== 0) seasonNeutral[sd.season] = false; }); })
	
	div.budget-impact-summary
		div.mb-2
			strong Budget Impact
		table.budget-impact-table
			thead
				tr
					th
					each season in budgetImpact.seasons
						th.text-center= season
			tbody
				each franchise in budgetImpact.franchises
					tr
						td= franchise.franchiseName
						each s in franchise.seasons
							- var delta = s.delta
							- var colorClass = delta > 0 ? 'text-success' : (delta < 0 ? 'text-danger' : 'text-muted')
							- var sign = delta > 0 ? '+' : (delta < 0 ? '-' : '')
							- var formatted = sign + formatMoney(Math.abs(delta))
							td.text-center(class=colorClass)= formatted
			if showCashNeutralButtons
				tfoot
					tr
						td
						each season in budgetImpact.seasons
							td.text-center
								if !seasonNeutral[season]
									button.btn.btn-sm.btn-outline-success.p-0.cash-neutral-btn(type="button" data-season=season style="display: inline-flex; align-items: center; justify-content: center; width: 100%; height: 22px;" title=`Make cash-neutral for ${season}`)
										i.fa.fa-balance-scale(style="font-size: 0.75rem;")
								else
									button.btn.btn-sm.btn-outline-success.p-0(type="button" disabled style="display: inline-flex; align-items: center; justify-content: center; width: 100%; height: 22px; opacity: 0.5;" title=`Already cash-neutral for ${season}`)
										span(style="font-size: 0.85rem; font-weight: bold;") =
