//- Budget Impact partial for trade machine
//- Can be rendered inline on initial page load or fetched via XHR
//- 
//- Expected data:
//- budgetImpact: { franchises: [{ franchiseName, seasons: [{ season, delta, available, resulting, violation }] }], isCashNeutral, warnings }

if budgetImpact && budgetImpact.franchises && budgetImpact.franchises.length > 0
	- var numSeasons = budgetImpact.seasons.length
	each franchise, idx in budgetImpact.franchises
		div.franchise-impact(class=idx > 0 ? 'mt-3' : '')
			div.franchise-name.font-weight-bold.text-center.mb-1= franchise.franchiseName
			table.table.table-sm.table-borderless.mb-0.w-100
				colgroup
					each s in budgetImpact.seasons
						col(style='width: ' + (100 / numSeasons) + '%;')
				thead
					tr.border-bottom
						each s in budgetImpact.seasons
							th.text-center= s
				tbody
					tr
						each s in franchise.seasons
							- var delta = s.delta
							- var resulting = s.resulting
							- var violation = s.violation
							td.text-center
								div.budget-delta.lead(class=deltaClass(delta))= formatMoney(delta, { sign: 'auto' })
								if resulting !== null
									if violation === 'hard' || violation === 'unrecoverable'
										div.budget-resulting.small.text-danger.font-weight-bold
											i.fa.fa-exclamation-circle.mr-1
											= formatMoney(resulting)
									else if violation === 'soft'
										div.budget-resulting.small.text-warning
											i.fa.fa-info-circle.mr-1
											= formatMoney(resulting)
									else
										div.budget-resulting.small.text-muted= formatMoney(resulting)
	//- Show warning summary if any violations
	if budgetImpact.warnings && budgetImpact.warnings.length > 0
		div.cap-warnings.mt-3
			each warning in budgetImpact.warnings
				if warning.type === 'error'
					div.alert.alert-danger.py-2.px-3.mb-2.small.d-flex.align-items-start
						i.fa.fa-exclamation-triangle.mr-2.mt-1.flex-shrink-0
						span
							strong= warning.franchise
							|  #{warning.text}
				else
					div.alert.alert-warning.py-2.px-3.mb-2.small.d-flex.align-items-start
						i.fa.fa-info-circle.mr-2.mt-1.flex-shrink-0
						span
							strong= warning.franchise
							|  #{warning.text}
else
	p.text-muted.mb-0 Select at least two parties to see budget impact.
