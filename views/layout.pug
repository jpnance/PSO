doctype html
html
	head
		meta(charset='utf-8')
		meta(name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no')
		
		//- Open Graph meta tags
		meta(property='og:site_name' content='Primetime Soap Operas')
		meta(property='og:type' content='website')
		block og_meta
			//- Default OG tags if not overridden
			meta(property='og:title' content=pageTitle || 'Primetime Soap Operas')
			meta(property='og:description' content='Extra since â€™08')
			meta(property='og:image' content='https://thedynastyleague.com/images/handshake.jpg')
		
		//- Twitter Card meta tags
		meta(name='twitter:card' content='summary_large_image')
		block twitter_meta

		link(rel='stylesheet' href='/css/bootstrap.min.css')
		link(rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css')
		link(rel='stylesheet' href='/css/design-tokens.css')
		link(rel='stylesheet' href='/css/sidebar.css')
		block styles

		script(src='/js/jquery.min.js')
		script(src='/js/bootstrap.min.js')

		title #{pageTitle || 'PSO'}

	body
		//- Build navigation structure
		- var nav = buildNav({ activePage: activePage, currentRosterId: currentRosterId, userFranchise: userFranchise, franchises: navFranchises, isAdmin: isAdmin })

		//- Top Bar
		header.topbar
			div.topbar-brand
				button.hamburger#sidebarToggle(type='button' aria-label='Toggle navigation')
					i.fa.fa-bars
				a(href='/' style='color: inherit; text-decoration: none;')
					h1 Primetime Soap Operas

			//- Search Bar (desktop)
			div.topbar-search#searchContainer
				i.fa.fa-search.search-icon
				input#searchInput(type='text' placeholder='Search players, franchises, trades...' autocomplete='off')
				kbd /

			//- Mobile search button
			button.mobile-search-btn#mobileSearchBtn(type='button' aria-label='Search')
				i.fa.fa-search

			//- User menu
			if user
				div.topbar-user-dropdown
					a.topbar-user(href='#' id='userDropdownToggle')
						i.fa.fa-user-circle.fa-lg
						span.d-none.d-sm-inline.ml-2 #{user.name}
						i.fa.fa-chevron-down.ml-2(style='font-size: 0.7rem;')
					div.topbar-user-menu#userDropdownMenu
						a(href='/logout')
							i.fa.fa-sign-out
							| Log Out (This Device)
						a(href='/logout/all')
							i.fa.fa-sign-out
							| Log Out (All Devices)
			else
				a.topbar-user(href='/login')
					i.fa.fa-sign-in.mr-2
					| Log In

		//- Sidebar Overlay (mobile)
		div.sidebar-overlay#sidebarOverlay

		//- Sidebar
		nav.nav-sidebar#sidebar
			div.sidebar-nav
				//- Mobile Search (shown in sidebar on mobile)
				div.sidebar-mobile-search.d-lg-none
					div.mobile-search-wrapper
						i.fa.fa-search
						input#mobileSearchInput(type='text' placeholder='Search...')

				//- Primary Section - Always Visible
				div.sidebar-primary
					each item in nav.primary
						if item.href
							a.sidebar-link(href=item.href class=(item.active ? 'active' : ''))
								i.fa(class=item.icon)
								= item.label
								if item.soon
									span.badge.badge-secondary Soon

				//- Collapsible Sections
				each section in nav.sections
					div.sidebar-section(class=(section.isAdmin ? 'sidebar-admin' : ''))
						button.sidebar-toggle(type='button' data-toggle='collapse' data-target='#' + section.id + 'Menu' aria-expanded=(section.expanded ? 'true' : 'false'))
							i.fa(class=section.icon)
							= section.label
							i.fa.fa-chevron-down.toggle-icon
						div(id=section.id + 'Menu' class=(section.expanded ? 'collapse show ' + (section.isFranchiseList ? 'franchise-list' : 'sidebar-submenu') : 'collapse ' + (section.isFranchiseList ? 'franchise-list' : 'sidebar-submenu')))
							each item in section.items
								a.sidebar-link(href=item.href class=(item.active ? 'active' : '') target=(item.external ? '_blank' : null))
									if item.icon
										i.fa(class=item.icon)
									= item.label
									if item.soon
										span.badge.badge-secondary Soon
									if item.external
										i.fa.fa-external-link.external-icon

		//- Main Content
		main.main-content
			if banner
				div.container-fluid
					div.alert.mb-3.rounded-0.text-center(class='alert-' + bannerStyle)
						if bannerStyle === 'danger'
							i.fa.fa-exclamation-circle.mr-2
						else if bannerStyle === 'warning'
							i.fa.fa-exclamation-triangle.mr-2
						else
							i.fa.fa-info-circle.mr-2
						= banner

			block content

		//- Sidebar JavaScript
		script.
			(function() {
				// Mobile sidebar toggle
				var hamburger = document.getElementById('sidebarToggle');
				var sidebar = document.getElementById('sidebar');
				var overlay = document.getElementById('sidebarOverlay');

				hamburger.addEventListener('click', function() {
					sidebar.classList.toggle('open');
					overlay.classList.toggle('open');
				});

				overlay.addEventListener('click', function() {
					sidebar.classList.remove('open');
					overlay.classList.remove('open');
				});

				// Close sidebar when clicking a link (mobile)
				var sidebarLinks = document.querySelectorAll('.sidebar-link');
				sidebarLinks.forEach(function(link) {
					link.addEventListener('click', function() {
						if (window.innerWidth < 992) {
							sidebar.classList.remove('open');
							overlay.classList.remove('open');
						}
					});
				});

				// Mobile search button - opens sidebar and focuses search
				var mobileSearchBtn = document.getElementById('mobileSearchBtn');
				var mobileSearchInput = document.getElementById('mobileSearchInput');
				
				if (mobileSearchBtn && mobileSearchInput) {
					mobileSearchBtn.addEventListener('click', function() {
						sidebar.classList.add('open');
						overlay.classList.add('open');
						setTimeout(function() {
							mobileSearchInput.focus();
						}, 300);
					});
				}

				// Desktop search keyboard shortcut
				var searchInput = document.getElementById('searchInput');
				if (searchInput) {
					document.addEventListener('keydown', function(e) {
						if (e.key === '/' && document.activeElement !== searchInput && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
							e.preventDefault();
							searchInput.focus();
						}
						if (e.key === 'Escape' && document.activeElement === searchInput) {
							searchInput.blur();
						}
					});
				}

				// User dropdown toggle
				var userDropdownToggle = document.getElementById('userDropdownToggle');
				var userDropdownMenu = document.getElementById('userDropdownMenu');
				
				if (userDropdownToggle && userDropdownMenu) {
					userDropdownToggle.addEventListener('click', function(e) {
						e.preventDefault();
						userDropdownMenu.classList.toggle('show');
					});

					// Close dropdown when clicking outside
					document.addEventListener('click', function(e) {
						if (!userDropdownToggle.contains(e.target) && !userDropdownMenu.contains(e.target)) {
							userDropdownMenu.classList.remove('show');
						}
					});
				}
			})();

		block scripts
