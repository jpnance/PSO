extends layout.pug

block styles
	style.
		.sunk-container {
			max-width: 600px;
		}
		.sunk-input-group {
			margin-bottom: 2rem;
		}
		.sunk-input {
			font-size: 1.5rem;
			padding: 0.75rem 1rem;
			border: 2px solid var(--border-light);
			border-radius: 6px;
			width: 100%;
			max-width: 280px;
			transition: border-color 0.15s ease;
		}
		.sunk-input:focus {
			outline: none;
			border-color: var(--color-info);
		}
		.sunk-input::placeholder {
			color: var(--text-tertiary);
		}
		.sunk-table {
			width: 100%;
			border-collapse: separate;
			border-spacing: 0;
		}
		.sunk-table th {
			background: #343a40;
			color: white;
			font-weight: 500;
			text-align: center;
			padding: 0.75rem 1rem;
		}
		.sunk-table th:first-child {
			border-top-left-radius: 6px;
		}
		.sunk-table th:last-child {
			border-top-right-radius: 6px;
		}
		.sunk-table td {
			font-size: 1.5rem;
			font-weight: 600;
			text-align: center;
			padding: 1rem;
			border: 1px solid var(--border-light);
			border-top: none;
			background: #f8f9fa;
		}
		.sunk-table td:first-child {
			border-left: 1px solid var(--border-light);
		}
		.sunk-table td:last-child {
			border-right: 1px solid var(--border-light);
		}
		.sunk-table tr:last-child td:first-child {
			border-bottom-left-radius: 6px;
		}
		.sunk-table tr:last-child td:last-child {
			border-bottom-right-radius: 6px;
		}
		.sunk-table .year-label {
			font-size: 0.85rem;
			font-weight: 400;
			color: var(--text-muted);
			display: block;
			margin-bottom: 0.25rem;
		}
		.sunk-table .sunk-item {
			text-align: center;
		}
		.sunk-table .sunk-item + .sunk-item {
			margin-top: 0.75rem;
			padding-top: 0.75rem;
			border-top: 1px solid var(--border-light);
		}
		.sunk-table .sunk-label {
			font-size: 0.7rem;
			font-weight: 500;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			display: block;
			margin-bottom: 0.25rem;
		}
		.sunk-table .sunk-label.buyout {
			color: var(--color-danger);
		}
		.sunk-table .sunk-label.recoverable {
			color: var(--color-success);
		}
		.sunk-table .sunk-value {
			font-size: 1.25rem;
			font-weight: 600;
		}
		.sunk-table .sunk-value.buyout {
			color: #c0392b;
		}
		.sunk-table .sunk-value.recoverable {
			color: #27ae60;
		}
		.sunk-table .sunk-value.empty {
			color: var(--text-muted);
		}
		
		/* Mobile: stack years vertically */
		@media (max-width: 500px) {
			.sunk-table thead {
				display: none;
			}
			.sunk-table,
			.sunk-table tbody,
			.sunk-table tr,
			.sunk-table td {
				display: block;
				width: 100%;
			}
			.sunk-table td {
				border-radius: 0;
				border: 1px solid var(--border-light);
				border-bottom: none;
			}
			.sunk-table td:first-child {
				border-top-left-radius: 6px;
				border-top-right-radius: 6px;
			}
			.sunk-table td:last-child {
				border-bottom: 1px solid var(--border-light);
				border-bottom-left-radius: 6px;
				border-bottom-right-radius: 6px;
			}
			.sunk-table td::before {
				content: attr(data-year);
				display: block;
				font-size: 0.75rem;
				font-weight: 600;
				text-transform: uppercase;
				letter-spacing: 0.5px;
				color: white;
				background: #343a40;
				margin: -1rem -1rem 1rem -1rem;
				padding: 0.5rem 1rem;
			}
		}
		.sunk-info {
			margin-top: 2rem;
			padding: 1rem 1.25rem;
			background: var(--pos-qb-bg);
			border-left: 4px solid var(--pos-qb-text);
			border-radius: 4px;
		}
		.sunk-info p {
			margin: 0;
			color: var(--pos-qb-text);
			font-size: 0.9rem;
		}
		.sunk-info p + p {
			margin-top: 0.5rem;
		}

block content
	div.container-fluid.py-3
		h1.mb-4 Sunk Cost Calculator

		div.sunk-container
			div.sunk-input-group
				input#salary.sunk-input(type='text' placeholder='Enter base salary...' inputmode='numeric')

			table.sunk-table
				thead
					tr
						th First Year
						th Second Year
						th Third Year
				tbody
					tr
						td(data-year='First Year')
							div.sunk-item
								span.sunk-label.buyout Buy-out (60%)
								span#yearOneBuyout.sunk-value.buyout.empty ?
							div.sunk-item
								span.sunk-label.recoverable Recoverable (40%)
								span#yearOneRecover.sunk-value.recoverable.empty ?
						td(data-year='Second Year')
							div.sunk-item
								span.sunk-label.buyout Buy-out (30%)
								span#yearTwoBuyout.sunk-value.buyout.empty ?
							div.sunk-item
								span.sunk-label.recoverable Recoverable (70%)
								span#yearTwoRecover.sunk-value.recoverable.empty ?
						td(data-year='Third Year')
							div.sunk-item
								span.sunk-label.buyout Buy-out (15%)
								span#yearThreeBuyout.sunk-value.buyout.empty ?
							div.sunk-item
								span.sunk-label.recoverable Recoverable (85%)
								span#yearThreeRecover.sunk-value.recoverable.empty ?

			div.sunk-info
				p When a player is cut, the buy-out portion of their salary is a "sunk cost" that continues to count against the cap. The rest of their salary is recoverable by the franchise.

block scripts
	script.
		(function() {
			var salaryInput = document.getElementById('salary');
			
			var elements = {
				yearOneBuyout: document.getElementById('yearOneBuyout'),
				yearOneRecover: document.getElementById('yearOneRecover'),
				yearTwoBuyout: document.getElementById('yearTwoBuyout'),
				yearTwoRecover: document.getElementById('yearTwoRecover'),
				yearThreeBuyout: document.getElementById('yearThreeBuyout'),
				yearThreeRecover: document.getElementById('yearThreeRecover')
			};

			function formatMoney(n) {
				return '$' + n.toLocaleString();
			}

			function setValues(buyoutEl, recoverEl, salary, buyoutPct) {
				if (salary > 0) {
					var buyout = Math.ceil(salary * buyoutPct);
					var recover = salary - buyout;
					buyoutEl.textContent = formatMoney(buyout);
					recoverEl.textContent = formatMoney(recover);
					buyoutEl.classList.remove('empty');
					recoverEl.classList.remove('empty');
				} else {
					buyoutEl.textContent = '?';
					recoverEl.textContent = '?';
					buyoutEl.classList.add('empty');
					recoverEl.classList.add('empty');
				}
			}

			function computeSunkCosts() {
				var rawValue = salaryInput.value.replace(/[^0-9]/g, '');
				var salary = (rawValue !== '' && !isNaN(parseInt(rawValue))) ? parseInt(rawValue) : 0;

				setValues(elements.yearOneBuyout, elements.yearOneRecover, salary, 0.6);
				setValues(elements.yearTwoBuyout, elements.yearTwoRecover, salary, 0.3);
				setValues(elements.yearThreeBuyout, elements.yearThreeRecover, salary, 0.15);
			}

			salaryInput.addEventListener('input', computeSunkCosts);
			computeSunkCosts();
		})();
