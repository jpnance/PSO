extends layout.pug
include mixins

block title
	+title('Transfer Franchise', 'Admin')

block styles
	link(rel='stylesheet' href='/css/league.css')
	link(rel='stylesheet' href='/css/transfer-franchise.css')

block content
	div.container.py-4
		h1.mb-4 Transfer Franchise
		
		p.lead.text-muted
			| Transfer ownership of a franchise to a new person. This will end the current regime and create a new one.
		
		form(method='POST' action='/admin/transfer-franchise')
			div.card.mb-4
				div.card-header
					strong Select Franchise
				div.card-body
					div.row
						div.col-md-6
							div.form-group
								label(for='franchiseId') Franchise
								select#franchiseId.form-control(name='franchiseId' required)
									option(value='') Select a franchise...
									each f in franchises
										option(value=f.id) #{f.displayName} (#{f.owners})
			
			div.card.mb-4
				div.card-header
					strong New Ownership
				div.card-body
					div.row
						div.col-md-6
							div.form-group
								label(for='newOwnerName') New Owner Name
								input#newOwnerName.form-control(
									type='text'
									name='newOwnerName'
									placeholder='Enter name...'
									required
									autocomplete='off'
								)
								div#peopleList.transfer-franchise__people-list
									each person in people
										div.transfer-franchise__people-item(data-name=person.name)= person.name
								small.form-text.text-muted
									| Start typing to see existing people, or enter a new name to create a new person.
						
						div.col-md-6
							div.form-group
								label(for='newDisplayName') New Display Name
								input#newDisplayName.form-control(
									type='text'
									name='newDisplayName'
									placeholder='e.g., "The Smiths" or "Smith/Jones"'
									required
								)
								small.form-text.text-muted
									| How this franchise will be displayed (can include co-owners).
					
					div.row
						div.col-md-4
							div.form-group
								label(for='effectiveSeason') Effective Season
								input#effectiveSeason.form-control(
									type='number'
									name='effectiveSeason'
									value=currentSeason
									required
								)
								small.form-text.text-muted
									| The season when the new ownership begins.
			
			div.d-flex.justify-content-between
				a.btn.btn-secondary(href='/admin') Cancel
				button.btn.btn-primary(type='submit') Transfer Franchise

block scripts
	script.
		// Simple autocomplete for owner name
		var input = document.getElementById('newOwnerName');
		var list = document.getElementById('peopleList');
		var items = list.querySelectorAll('.transfer-franchise__people-item');
		
		input.addEventListener('focus', function() {
			filterList();
			list.classList.add('transfer-franchise__people-list--show');
		});
		
		input.addEventListener('blur', function() {
			// Delay to allow click on list item
			setTimeout(function() {
				list.classList.remove('transfer-franchise__people-list--show');
			}, 200);
		});
		
		input.addEventListener('input', function() {
			filterList();
		});
		
		function filterList() {
			var val = input.value.toLowerCase();
			var hasVisible = false;
			items.forEach(function(item) {
				var name = item.getAttribute('data-name').toLowerCase();
				if (name.includes(val)) {
					item.style.display = '';
					hasVisible = true;
				} else {
					item.style.display = 'none';
				}
			});
			if (hasVisible && val.length > 0) {
				list.classList.add('transfer-franchise__people-list--show');
			}
		}
		
		items.forEach(function(item) {
			item.addEventListener('click', function() {
				input.value = item.getAttribute('data-name');
				list.classList.remove('transfer-franchise__people-list--show');
				// Auto-fill display name if empty
				var displayInput = document.getElementById('newDisplayName');
				if (!displayInput.value) {
					displayInput.value = item.getAttribute('data-name');
				}
			});
		});
