extends layout

mixin pickRound(round)
	if round == 1
		| 1st
	else if round == 2
		| 2nd
	else if round == 3
		| 3rd
	else
		| #{round}th

block styles
	link(rel='stylesheet' href='/trade.css')

block content
	//- Hidden master lists for JavaScript to clone from
	div.d-none
		select.master-player-list
			each franchise in franchises
				optgroup(class="players-" + franchise._id label="From " + franchise.displayName)
					each player in teams[franchise._id.toString()]
						option(value=player.id data-name=player.name data-terms=player.terms data-salary=player.salary data-contract=player.contract)
							| #{player.name}
							|  
							if player.terms == 'unsigned'
								| ($#{player.salary}, unsigned)
							else if player.terms == 'rfa-rights'
								| (RFA rights)
							else
								| ($#{player.salary}, #{player.contract})

		select.master-pick-list
			-
				function formatPickNum(pickNumber, round, season) {
					if (!pickNumber) return null;
					var teamsPerRound = (season <= 2011) ? 10 : 12;
					var pickInRound = ((pickNumber - 1) % teamsPerRound) + 1;
					return round + '.' + String(pickInRound).padStart(2, '0');
				}
			each franchise in franchises
				optgroup(class="picks-" + franchise._id label=franchise.displayName + "'s Picks")
					each pick in picks
						if pick.ownerId == franchise._id.toString()
							- var pickNumDisplay = formatPickNum(pick.pickNumber, pick.round, pick.season)
							option(value=pick.id data-season=pick.season data-round=pick.round data-picknumber=(pick.pickNumber || '') data-owner=pick.owner data-origin=pick.origin)
								+pickRound(pick.round)
								|  round draft pick
								if pickNumDisplay
									|  (##{pickNumDisplay})
								|  from #{pick.origin} in #{pick.season}

		select.master-franchise-list
			each franchise in franchises
				option(class="franchises-" + franchise._id value=franchise._id data-name=franchise.displayName) #{franchise.displayName}

	div.container.py-4
		h1.mb-4 Trade Machine

		div.row
			//- Franchise Selection Card (narrower on large screens)
			div.col-lg-4.col-xl-3.mb-4
				div.card
					div.card-header
						strong Select Parties
					div.card-body
						div.franchise-list
							each franchise in franchises
								div.form-check.mb-1
									input.form-check-input(type="checkbox" id="check-" + franchise._id value=franchise._id)
									label.form-check-label(for="check-" + franchise._id)= franchise.displayName
						div.mt-3
							button.reset-trade-machine.btn.btn-outline-secondary.btn-sm.btn-block
								i.fa.fa-refresh.mr-1
								| Reset

				//- Trade Tools Card
				div.card.trade-tools-card.d-none.mt-4.mb-4
					div.card-body
						button.cash-neutral-btn.btn.btn-outline-success.btn-sm.btn-block
							i.fa.fa-balance-scale.mr-1
							span.btn-text Make Cash-Neutral

			//- Trade Builder Section
			div.col-lg-8.col-xl-9
				each franchise in franchises
					div.gets.d-none.mb-4(id="gets-" + franchise._id)
							div.card.h-100
								div.card-header.d-flex.justify-content-between.align-items-center
									span
										strong= franchise.displayName
										|  receive#{isPlural(franchise.displayName) ? '' : 's'}
									span.badge.badge-light.asset-count 0 assets

								div.card-body
									//- Add Player
									div.input-group.input-group-sm.mb-2
										div.input-group-prepend
											span.input-group-text.player-icon
												i.fa.fa-user
										select.player-list.form-control
										div.input-group-append
											button.add-player.btn.btn-primary(type="button")
												i.fa.fa-plus

									//- Add Pick
									div.input-group.input-group-sm.mb-2
										div.input-group-prepend
											span.input-group-text.pick-icon
												i.fa.fa-ticket
										select.pick-list.form-control
										div.input-group-append
											button.add-pick.btn.btn-primary(type="button")
												i.fa.fa-plus

									//- Add Cash
									div.input-group.input-group-sm.mb-3
										div.input-group-prepend
											span.input-group-text.cash-icon $
										input.amount.form-control(type="number" placeholder="Amount")
										select.franchise-list.form-control
										select.season-list.form-control
											option #{parseInt(season)}
											option #{parseInt(season) + 1}
											option #{parseInt(season) + 2}
										div.input-group-append
											button.add-cash.btn.btn-primary(type="button")
												i.fa.fa-plus

									hr.asset-separator

									//- Assets List
									div.assets-container
										ul.assets.list-unstyled.mb-0
											li.text-muted.empty-state
												i.fa.fa-inbox.mr-2
												| Nothing yet

block scripts
	script.
		var currentSeason = #{season};
	script(src='/trade.js')
