extends layout

mixin pickRound(round)
	if round == 1
		| 1st
	else if round == 2
		| 2nd
	else if round == 3
		| 3rd
	else
		| #{round}th

block styles
	link(rel='stylesheet' href='/trade.css')

block content
	//- Hidden master lists for JavaScript to clone from
	div.d-none
		select.master-player-list
			each franchise in franchises
				optgroup(class="players-" + franchise._id label="From " + franchise.displayName)
					each player in teams[franchise._id.toString()]
						option(value=player.id data-name=player.name data-terms=player.terms data-salary=player.salary data-contract=player.contract)
							| #{player.name}
							|  
							if player.terms == 'unsigned'
								| ($#{player.salary}, unsigned)
							else if player.terms == 'rfa-rights'
								| (RFA rights)
							else
								| ($#{player.salary}, #{player.contract})

		select.master-pick-list
			-
				function formatPickNum(pickNumber, round, season) {
					if (!pickNumber) return null;
					var teamsPerRound = (season <= 2011) ? 10 : 12;
					var pickInRound = ((pickNumber - 1) % teamsPerRound) + 1;
					return round + '.' + String(pickInRound).padStart(2, '0');
				}
			each franchise in franchises
				optgroup(class="picks-" + franchise._id label=franchise.displayName + "'s Picks")
					each pick in picks
						if pick.ownerId == franchise._id.toString()
							- var pickNumDisplay = formatPickNum(pick.pickNumber, pick.round, pick.season)
							option(value=pick.id data-season=pick.season data-round=pick.round data-picknumber=(pick.pickNumber || '') data-owner=pick.owner data-origin=pick.origin)
								+pickRound(pick.round)
								|  round draft pick
								if pickNumDisplay
									|  (##{pickNumDisplay})
								|  from #{pick.origin} in #{pick.season}

		select.master-franchise-list
			each franchise in franchises
				option(class="franchises-" + franchise._id value=franchise._id data-name=franchise.displayName) #{franchise.displayName}

	div.container.py-4
		h1.mb-4 Trade Machine

		//- Franchise Selection Card
		div.card.mb-4
			div.card-header
				strong Select Parties
			div.card-body
				div.row
					each franchise in franchises
						div.col-6.col-md-4.col-lg-3.mb-2
							div.form-check
								input.form-check-input(type="checkbox" id="check-" + franchise._id value=franchise._id)
								label.form-check-label(for="check-" + franchise._id)= franchise.displayName
				div.text-center.mt-3
					button.reset-trade-machine.btn.btn-outline-secondary.btn-sm
						i.fa.fa-refresh.mr-1
						| Reset

		//- Trade Builder Section
		div.row
			each franchise in franchises
				div.col-lg-6.gets.d-none.mb-4(id="gets-" + franchise._id)
					div.card.h-100
						div.card-header.d-flex.justify-content-between.align-items-center
							span
								strong= franchise.displayName
								|  receives
							span.badge.badge-light.asset-count 0 assets

						div.card-body
							//- Add Player
							div.input-group.input-group-sm.mb-2
								div.input-group-prepend
									span.input-group-text
										i.fa.fa-user
								select.player-list.form-control
								div.input-group-append
									button.add-player.btn.btn-primary(type="button")
										i.fa.fa-plus

							//- Add Pick
							div.input-group.input-group-sm.mb-2
								div.input-group-prepend
									span.input-group-text
										i.fa.fa-ticket
								select.pick-list.form-control
								div.input-group-append
									button.add-pick.btn.btn-primary(type="button")
										i.fa.fa-plus

							//- Add Cash
							div.input-group.input-group-sm.mb-3
								div.input-group-prepend
									span.input-group-text $
								input.amount.form-control(type="number" placeholder="Amount")
								select.franchise-list.form-control
								select.season-list.form-control
									option #{parseInt(season)}
									option #{parseInt(season) + 1}
									option #{parseInt(season) + 2}
								div.input-group-append
									button.add-cash.btn.btn-primary(type="button")
										i.fa.fa-plus

							//- Assets List
							div.assets-container
								ul.assets.list-unstyled.mb-0
									li.text-muted.empty-state
										i.fa.fa-inbox.mr-2
										| Nothing yet

						div.card-footer.text-muted.small
							| Add players, picks, or cash using the fields above

block scripts
	script(src='/trade.js')
